<!DOCTYPE html>
<html>
    <head>
        <title>Cucumber Feature Execution result</title>
        <meta charset="utf-8">
        <link rel="stylesheet" href="/public/stylesheets/bootstrap.css">
        <style type="text/css">
	      body {
	        padding-top: 60px;
	        padding-bottom: 40px;
	      }
	      .sidebar-nav {
	        padding: 9px 0;
	      }
	    </style>
        <style> 
    .passed {
      color: green;
    }
    .skipped {
      color: cyan;
    }
    .failed {
      color: red;
    }
    
    .error {
      color: red;
    }
  </style>
    </head>
    <body>
        <div class="navbar navbar-fixed-top">
      		<div class="navbar-inner">
        		<div class="container-fluid">          			          			
          			<a class="brand" href="/@cukes">Cucumber Runner</a>
      				<div class="nav-collapse">
        				<ul class="nav">
          					<li class="active"><a href="/@cukes"><i class="icon-home icon-white"></i> Home </a></li>
          					        				</ul>        				
      				</div>      			
        		</div>
      		</div>
		</div>
		
        <div class="container-fluid">
      		<div class="row-fluid">          
                
                                                                                                                                                                                     


<div id="errors" style="visibility:hidden; display: none;">
</div>

<div class="row-fluid">
	<div class="span12">
	    <a href="/@cukes/feature/run/sandbox/another.feature" class="btn">Run...</a>
	    <hr/> 
        <p id="result" class="result"></p>
                <div class="alert alert-block">        
            <a class="close" data-dismiss="alert" href="#"></a>
	        You can <strong>implement missing steps</strong> with the snippets below:<br/>	            
	        <pre>
                        @Given(&quot;^I am on the Google Home Page$&quot;)
public void I_am_on_the_Google_Home_Page() {
    // Express the Regexp above with the code you wish you had
}

	                    @When(&quot;^I search for \&quot;([^\&quot;]*)\&quot;$&quot;)
public void I_search_for(String arg1) {
    // Express the Regexp above with the code you wish you had
}

	                    @Then(&quot;^I should see at least (\\d+),(\\d+) results$&quot;)
public void I_should_see_at_least_results(int arg1, int arg2) {
    // Express the Regexp above with the code you wish you had
}

	                    @When(&quot;^I convert (\\d+) cm to inches$&quot;)
public void I_convert_cm_to_inches(int arg1) {
    // Express the Regexp above with the code you wish you had
}

	                    @Then(&quot;^I should see the conversion result \&quot;([^\&quot;]*)\&quot;$&quot;)
public void I_should_see_the_conversion_result(String arg1) {
    // Express the Regexp above with the code you wish you had
}

	                    @When(&quot;^I search for a ridiculously small number of results$&quot;)
public void I_search_for_a_ridiculously_small_number_of_results() {
    // Express the Regexp above with the code you wish you had
}

	                    @Then(&quot;^I should see at most (\\d+) results$&quot;)
public void I_should_see_at_most_results(int arg1) {
    // Express the Regexp above with the code you wish you had
}

	                    </pre>
        </div>
        	</div>
</div>

	            
          	</div>      
      		<hr>
      		<footer></footer>
    	</div>
	        	    	
    	    	
    	<script src="/public/javascripts/jquery-1.7.1.min.js" type="text/javascript" charset="utf-8"></script>        
            
    <script src="/public/javascripts/ICanHaz.min.js"></script>

    <script id="executionResult" type="text/html">
        {{> tags}}
        {{> feature}}
        {{> scenarios}}
    </script>

    <script id="tags" type="text/html">
        <p>
        {{#tags}}            
            <span class="label label-info">{{name}}</span>
        {{/tags}}
        {{^tags}}
           This feature as no Tags.
        {{/tags}}
        </p>            
    </script>
    
    <script id="feature" type="text/html">
        <h3><a href="/@cukes/feature/sandbox/another.feature">Feature: {{name}}</a></h3>
        <p>{{#formatDescription}} {{description}} {{/formatDescription}}</p>
    </script>
    
    <script id="scenarios" type="text/html">
        <p>                        
            {{#elements}}
                <p>
                    <ul>
                        <li><h4>ScenarioOutline: : {{ name }} <small>&#35;{{uri}}:{{line}}</small> {{{totalElapsedTime}}}</h4></li>
                        <ul>
                        {{#steps}}
                            <li>
                                <span class="{{result.status}}"><b>{{ keyword }}</b> {{{highlightStep}}}</span> 
                                {{#match}}<small>&#35;{{location}}</small>{{/match}}
                                                                <small><i>&nbsp;{{{durationInMillis}}}</i></small>
                                {{#hasErrors}}
                                {{{errorDetail}}
                                {{/hasErrors}}
                            </li>
                        {{/steps}}
                        </ul>                     
                    </ul>                    
                    {{#isScenarioOutline}}
                    <b>Examples:</b>
                    {{/isScenarioOutline}}
                    <hr/>
                <p>                
            {{/elements}}
        </p>        
    </script>
    
    <script type="text/javascript">
    $(document).ready(function(){
        var report = [{"id":"google-search","description":"As a casual internet user\nI want to find some information about watir, and do a quick conversion\n So that I can be knowledgeable being","name":"Google Search","keyword":"Feature","line":1,"elements":[{"id":"google-search;search-for-watir","description":"","name":"Search for Watir","keyword":"Scenario","line":6,"steps":[{"result":{"status":"undefined"},"name":"I am on the Google Home Page","keyword":"Given ","line":7,"match":{}},{"result":{"status":"undefined"},"name":"I search for \"Watir\"","keyword":"When ","line":8,"match":{}},{"result":{"status":"undefined"},"name":"I should see at least 100,000 results","keyword":"Then ","line":9,"match":{}}],"type":"scenario"},{"id":"google-search;do-a-unit-conversion","description":"","name":"Do a unit conversion","keyword":"Scenario","line":11,"steps":[{"result":{"status":"undefined"},"name":"I am on the Google Home Page","keyword":"Given ","line":12,"match":{}},{"result":{"status":"undefined"},"name":"I convert 10 cm to inches","keyword":"When ","line":13,"match":{}},{"result":{"status":"undefined"},"name":"I should see the conversion result \"10 centimeters \u003d 3.93700787 inches\"","keyword":"Then ","line":14,"match":{}}],"type":"scenario"},{"id":"google-search;do-a-search-using-data-specified-externally","description":"","name":"Do a search using data specified externally","keyword":"Scenario","line":16,"steps":[{"result":{"status":"undefined"},"name":"I am on the Google Home Page","keyword":"Given ","line":17,"match":{}},{"result":{"status":"undefined"},"name":"I search for a ridiculously small number of results","keyword":"When ","line":18,"match":{}},{"result":{"status":"undefined"},"name":"I should see at most 5 results","keyword":"Then ","line":19,"match":{}}],"type":"scenario"}],"uri":"sandbox/another.feature"}][0];
        var errorIndex=1;
        report.formatDescription=function() {
            return function(description, render) {
                return '<dl><dd>'+render(description).replace(/\n/g,"</dd><dd>")+'</dd></dl>';
            }
        };
        report.isScenarioOutline=function() { return this.type=='scenario_outline'; };         
        report.hasErrors=function() { return this.result && this.result.error_message; };
        report.highlightStep=function() { 
            var res = this.name.replace('>','&gt;</b>').replace('<','<b>&lt;');
            if(this.match && this.match.arguments){
                var val = this.match.arguments[0].val;
                var offset = this.match.arguments[0].offset;
                res=this.name.substr(0, offset)+'<b>'+val+'</b>';
                if(this.name.length>(offset+val.length)){
                    res+=this.name.substr(offset+val.length);
                }                                  
            }
            return res;
        };      
        report.errorDetail=function() { 
            var errorDetail=$('#error'+errorIndex).html();
            errorIndex++;
            return errorDetail;
        };
        report.totalElapsedTime=function() {
            if(this.type=='scenario'){
                var duration = 10;
                jQuery.each(this.steps, function() {
                    if(this.result){duration+=this.result.duration;}
                });
                // duration is reported in nanos
                duration = (duration/1000000).toFixed(2);
                if(!isNaN(duration)){
	                if(duration>1000){
	                    duration=(duration/1000).toFixed(1);
	                    return '<small><i>(in '+duration+' s.)</i></small>';
	                }else{
	                    return '<small><i>(in '+duration+' ms.)</i></small>';
	                }
                }                
            }
            return '';
        };
        report.durationInMillis=function() {             
            if(this.result){                
                // duration is reported in nanos
                var duration = (this.result.duration/1000000).toFixed(2);
                if(!isNaN(duration)){  
                    return '<small><i>(in '+duration+' ms.)</i></small>';
                }
            }
            return '';
        };   
        console.log(report);        
		$('#result').append(ich.executionResult(report));                
    })
	</script> 
    </body>
</html>